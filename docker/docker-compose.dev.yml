# =============================================================================
# 芋道 - 开发环境 Docker Compose
# 用途：本地开发（后端服务）
# 依赖：需先启动 docker-compose.infra.yml
# 启动：docker compose -f docker/docker-compose.infra.yml -f docker/docker-compose.dev.yml up -d
# =============================================================================

name: yudao-dev

services:
  server:
    container_name: yudao-server-dev
    build:
      context: ..
      dockerfile: docker/server/Dockerfile.dev
    image: yudao-server:dev
    restart: unless-stopped
    ports:
      - "${SERVER_PORT:-48080}:48080"
      - "${DEBUG_PORT:-5005}:5005"
    environment:
      SPRING_PROFILES_ACTIVE: local
      JAVA_OPTS: >-
        -Xms512m
        -Xmx1024m
        -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
      ARGS: >-
        --spring.datasource.dynamic.datasource.master.url=jdbc:postgresql://yudao-postgres:5432/${POSTGRES_DB:-ruoyi-vue-pro}
        --spring.datasource.dynamic.datasource.master.username=${POSTGRES_USER:-postgres}
        --spring.datasource.dynamic.datasource.master.password=${POSTGRES_PASSWORD:-123456}
        --spring.data.redis.host=yudao-redis
    volumes:
      - ../yudao-server/target/yudao-server.jar:/yudao-server/app.jar:ro
      - server_dev_logs:/yudao-server/logs
    networks:
      - yudao-infra_yudao-network

volumes:
  server_dev_logs:

networks:
  yudao-infra_yudao-network:
    external: true
