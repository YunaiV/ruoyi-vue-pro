# é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº²

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºèŠ‹é“å¼€æºæ¡†æ¶å¼€å‘çš„é€‰ç…¤å‚æ™ºèƒ½ç”Ÿäº§ç®¡æ§ç³»ç»Ÿï¼Œå®ç°ç”Ÿäº§è°ƒåº¦ã€è®¾å¤‡ç®¡ç†ã€ç…¤è´¨ç®¡ç†ã€å®‰å…¨ç®¡ç†ç­‰å…¨æµç¨‹æ•°å­—åŒ–ç®¡ç†ã€‚

### æŠ€æœ¯æ¶æ„
- **åç«¯**ï¼šSpring Boot + MyBatis-Plus + SQL Server
- **å‰ç«¯**ï¼šVue 3 + TypeScript + Element Plus
- **æ¡†æ¶**ï¼šèŠ‹é“å¼€æºæ¡†æ¶ (ruoyi-vue-pro)
- **æ•°æ®åº“**ï¼šSQL Server 2019+
- **éƒ¨ç½²**ï¼šDocker + Nginx

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ¨¡å—åˆ’åˆ†

```
yudao-module-coal/                    # é€‰ç…¤å‚æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ production/                       # ç”Ÿäº§è°ƒåº¦ç®¡ç†
â”œâ”€â”€ equipment/                        # è®¾å¤‡æ¡£æ¡ˆç®¡ç†  
â”œâ”€â”€ quality/                          # ç…¤è´¨ç®¡ç†
â”œâ”€â”€ safety/                          # å®‰å…¨ç®¡ç†
â”œâ”€â”€ energy/                          # èƒ½æºç®¡ç†
â”œâ”€â”€ report/                          # æŠ¥è¡¨ç»Ÿè®¡
â””â”€â”€ common/                          # å…¬å…±ç»„ä»¶
```

### æ•°æ®åº“è®¾è®¡åŸåˆ™
- é‡‡ç”¨ SQL Server æ•°æ®åº“
- éµå¾ªç¬¬ä¸‰èŒƒå¼è®¾è®¡
- æ”¯æŒå¤šç§Ÿæˆ·æ¶æ„
- é¢„ç•™æ‰©å±•å­—æ®µ
- å»ºç«‹å®Œæ•´çš„ç´¢å¼•ä½“ç³»

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è¯¦è§£

### 1. ç”Ÿäº§è°ƒåº¦ç®¡ç†æ¨¡å—

#### 1.1 ç”Ÿäº§è®¡åˆ’è¡¨ (coal_production_plan)
```sql
CREATE TABLE coal_production_plan (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    plan_code NVARCHAR(50) NOT NULL,              -- è®¡åˆ’ç¼–å·
    plan_type TINYINT NOT NULL,                   -- è®¡åˆ’ç±»å‹ï¼š1å¹´åº¦ 2æœˆåº¦ 3æ—¥è®¡åˆ’ 4ç­è®¡åˆ’
    plan_year INT,                                -- è®¡åˆ’å¹´åº¦
    plan_month TINYINT,                           -- è®¡åˆ’æœˆä»½
    plan_date DATE,                               -- è®¡åˆ’æ—¥æœŸ
    shift_id BIGINT,                              -- ç­æ¬¡ID
    
    -- è®¡åˆ’äº§é‡æ•°æ®
    raw_coal_plan DECIMAL(10,2),                  -- è®¡åˆ’å…¥æ´—åŸç…¤é‡(å¨)
    clean_coal_plan DECIMAL(10,2),                -- è®¡åˆ’ç²¾ç…¤äº§é‡(å¨)
    middling_coal_plan DECIMAL(10,2),             -- è®¡åˆ’ä¸­ç…¤äº§é‡(å¨)
    slime_plan DECIMAL(10,2),                     -- è®¡åˆ’ç…¤æ³¥äº§é‡(å¨)
    gangue_plan DECIMAL(10,2),                    -- è®¡åˆ’çŸ¸çŸ³äº§é‡(å¨)
    
    -- è´¨é‡æŒ‡æ ‡
    clean_coal_ash DECIMAL(5,2),                  -- ç²¾ç…¤ç°åˆ†(%)
    middling_coal_ash DECIMAL(5,2),               -- ä¸­ç…¤ç°åˆ†(%)
    
    -- è®¡åˆ’çŠ¶æ€
    plan_status TINYINT DEFAULT 1,                -- è®¡åˆ’çŠ¶æ€ï¼š1å¾…æ‰§è¡Œ 2æ‰§è¡Œä¸­ 3å·²å®Œæˆ 4å·²å–æ¶ˆ
    
    -- å®¡æ‰¹ä¿¡æ¯
    creator_id BIGINT,                            -- åˆ¶å®šäººID
    approver_id BIGINT,                           -- å®¡æ‰¹äººID
    approve_time DATETIME,                        -- å®¡æ‰¹æ—¶é—´
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 1.2 äº§é‡æŠ¥è¡¨ (coal_production_output)
```sql
CREATE TABLE coal_production_output (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    output_date DATE NOT NULL,                    -- ç”Ÿäº§æ—¥æœŸ
    shift_id BIGINT NOT NULL,                     -- ç­æ¬¡ID
    system_id BIGINT,                             -- ç”Ÿäº§ç³»ç»ŸID
    
    -- å®é™…äº§é‡æ•°æ®
    raw_coal_actual DECIMAL(10,2),                -- å®é™…å…¥æ´—åŸç…¤é‡(å¨)
    clean_coal_actual DECIMAL(10,2),              -- å®é™…ç²¾ç…¤äº§é‡(å¨)
    middling_coal_actual DECIMAL(10,2),           -- å®é™…ä¸­ç…¤äº§é‡(å¨)
    slime_actual DECIMAL(10,2),                   -- å®é™…ç…¤æ³¥äº§é‡(å¨)
    gangue_actual DECIMAL(10,2),                  -- å®é™…çŸ¸çŸ³äº§é‡(å¨)
    
    -- è´¨é‡æ•°æ®
    clean_coal_ash_actual DECIMAL(5,2),           -- å®é™…ç²¾ç…¤ç°åˆ†(%)
    clean_coal_moisture DECIMAL(5,2),             -- ç²¾ç…¤æ°´åˆ†(%)
    
    -- æ•ˆç‡æŒ‡æ ‡
    clean_coal_yield DECIMAL(5,2),                -- ç²¾ç…¤äº§ç‡(%)
    recovery_rate DECIMAL(5,2),                   -- å›æ”¶ç‡(%)
    
    -- è¿è¡Œæ—¶é—´
    coal_feeding_time INT,                        -- å¸¦ç…¤æ—¶é—´(åˆ†é’Ÿ)
    stop_time INT,                                -- åœç…¤æ—¶é—´(åˆ†é’Ÿ)
    
    -- å½•å…¥äººå‘˜
    recorder_id BIGINT,                           -- è®°å½•äººID
    record_time DATETIME,                         -- è®°å½•æ—¶é—´
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 1.3 è°ƒåº¦ç®¡ç†è¡¨ (coal_dispatch_record)
```sql
CREATE TABLE coal_dispatch_record (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    record_date DATE NOT NULL,                    -- è®°å½•æ—¥æœŸ
    shift_id BIGINT NOT NULL,                     -- ç­æ¬¡ID
    dispatcher_id BIGINT NOT NULL,                -- è°ƒåº¦å‘˜ID
    
    -- è¿è½¬æƒ…å†µ
    system_status NVARCHAR(500),                  -- ç³»ç»Ÿè¿è½¬æƒ…å†µ
    coal_type NVARCHAR(100),                      -- å…¥æ´—åŸç…¤ç±»å‹
    
    -- é—®é¢˜äº‹æ•…
    accident_description NTEXT,                   -- äº‹æ•…æè¿°
    accident_level TINYINT,                       -- äº‹æ•…çº§åˆ«ï¼š1è½»å¾® 2ä¸€èˆ¬ 3ä¸¥é‡ 4é‡å¤§
    accident_type TINYINT,                        -- äº‹æ•…ç±»å‹ï¼š1ç”Ÿäº§ 2æœºç”µ 3å®‰å…¨
    
    -- æŒ‡ç¤ºå†…å®¹
    instruction_content NTEXT,                    -- ä¸Šä¼ ä¸‹è¾¾æŒ‡ç¤ºå†…å®¹
    instruction_from NVARCHAR(100),               -- æŒ‡ç¤ºæ¥æº
    instruction_to NVARCHAR(100),                 -- æŒ‡ç¤ºå¯¹è±¡
    
    -- äº¤æ¥ç­
    handover_issues NTEXT,                        -- äº¤æ¥ç­é—ç•™é—®é¢˜
    next_shift_notice NTEXT,                      -- ä¸‹ç­æ³¨æ„äº‹é¡¹
    
    -- åœç…¤è®°å½•
    stop_reason NVARCHAR(200),                    -- åœç…¤åŸå› 
    stop_start_time DATETIME,                     -- åœç…¤å¼€å§‹æ—¶é—´
    stop_end_time DATETIME,                       -- åœç…¤ç»“æŸæ—¶é—´
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 1.4 ç­æ¬¡ç®¡ç†è¡¨ (coal_shift_config)
```sql
CREATE TABLE coal_shift_config (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    shift_name NVARCHAR(50) NOT NULL,             -- ç­æ¬¡åç§°
    shift_code NVARCHAR(20) NOT NULL,             -- ç­æ¬¡ç¼–ç 
    start_time TIME NOT NULL,                     -- å¼€å§‹æ—¶é—´
    end_time TIME NOT NULL,                       -- ç»“æŸæ—¶é—´
    shift_type TINYINT NOT NULL,                  -- ç­æ¬¡ç±»å‹ï¼š1ç”Ÿäº§ç­ 2æ£€ä¿®ç­ 3å€¼ç­
    is_production BIT DEFAULT 1,                  -- æ˜¯å¦ç”Ÿäº§ç­
    sort_order INT DEFAULT 0,                     -- æ’åº
    status TINYINT DEFAULT 1,                     -- çŠ¶æ€ï¼š0ç¦ç”¨ 1å¯ç”¨
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 1.5 æ’ç­è¡¨ (coal_shift_schedule)
```sql
CREATE TABLE coal_shift_schedule (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    schedule_date DATE NOT NULL,                  -- æ’ç­æ—¥æœŸ
    shift_id BIGINT NOT NULL,                     -- ç­æ¬¡ID
    user_id BIGINT NOT NULL,                      -- å‘˜å·¥ID
    position_type TINYINT NOT NULL,               -- å²—ä½ç±»å‹ï¼š1è°ƒåº¦å‘˜ 2æ“ä½œå·¥ 3æ£€ä¿®å·¥
    is_leader BIT DEFAULT 0,                      -- æ˜¯å¦ç­é•¿
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

### 2. è®¾å¤‡æ¡£æ¡ˆç®¡ç†æ¨¡å—

#### 2.1 è®¾å¤‡åŸºç¡€ä¿¡æ¯è¡¨ (coal_equipment_info)
```sql
CREATE TABLE coal_equipment_info (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    equipment_code NVARCHAR(50) NOT NULL,         -- è®¾å¤‡ç¼–å·
    equipment_name NVARCHAR(100) NOT NULL,        -- è®¾å¤‡åç§°
    equipment_type_id BIGINT NOT NULL,            -- è®¾å¤‡ç±»å‹ID
    system_id BIGINT NOT NULL,                    -- æ‰€å±ç³»ç»ŸID
    workshop_id BIGINT,                           -- æ‰€å±è½¦é—´ID
    
    -- è®¾å¤‡åŸºæœ¬ä¿¡æ¯
    model NVARCHAR(100),                          -- è®¾å¤‡å‹å·
    manufacturer NVARCHAR(100),                   -- åˆ¶é€ å‚å•†
    manufacture_date DATE,                        -- åˆ¶é€ æ—¥æœŸ
    install_date DATE,                            -- å®‰è£…æ—¥æœŸ
    commission_date DATE,                         -- æŠ•äº§æ—¥æœŸ
    
    -- æŠ€æœ¯å‚æ•°
    rated_power DECIMAL(10,2),                    -- é¢å®šåŠŸç‡(kW)
    rated_capacity DECIMAL(10,2),                 -- é¢å®šå¤„ç†èƒ½åŠ›(t/h)
    weight DECIMAL(10,2),                         -- è®¾å¤‡é‡é‡(t)
    dimensions NVARCHAR(100),                     -- å¤–å½¢å°ºå¯¸
    
    -- è®¾å¤‡çŠ¶æ€
    equipment_status TINYINT DEFAULT 1,           -- è®¾å¤‡çŠ¶æ€ï¼š1æ­£å¸¸ 2æ•…éšœ 3æ£€ä¿® 4åœç”¨
    health_level TINYINT DEFAULT 1,               -- å¥åº·ç­‰çº§ï¼š1ä¼˜è‰¯ 2è‰¯å¥½ 3æ³¨æ„ 4å¼‚å¸¸
    
    -- ä½ç½®ä¿¡æ¯
    location NVARCHAR(200),                       -- å®‰è£…ä½ç½®
    qr_code NVARCHAR(200),                        -- äºŒç»´ç 
    
    -- è´£ä»»äºº
    responsible_person_id BIGINT,                 -- è´£ä»»äººID
    maintenance_person_id BIGINT,                 -- ç»´æŠ¤äººID
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 2.2 è®¾å¤‡ç±»å‹è¡¨ (coal_equipment_type)
```sql
CREATE TABLE coal_equipment_type (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    type_name NVARCHAR(100) NOT NULL,             -- ç±»å‹åç§°
    type_code NVARCHAR(50) NOT NULL,              -- ç±»å‹ç¼–ç 
    parent_id BIGINT DEFAULT 0,                   -- çˆ¶çº§ID
    level_path NVARCHAR(500),                     -- å±‚çº§è·¯å¾„
    sort_order INT DEFAULT 0,                     -- æ’åº
    description NVARCHAR(500),                    -- æè¿°
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 2.3 è®¾å¤‡å±¥å†è¡¨ (coal_equipment_history)
```sql
CREATE TABLE coal_equipment_history (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    equipment_id BIGINT NOT NULL,                 -- è®¾å¤‡ID
    history_type TINYINT NOT NULL,                -- å±¥å†ç±»å‹ï¼š1è´­ä¹° 2å®‰è£… 3ç»´ä¿® 4ä¿å…» 5æ”¹é€  6æŠ¥åºŸ
    history_date DATE NOT NULL,                   -- å±¥å†æ—¥æœŸ
    
    -- å±¥å†å†…å®¹
    title NVARCHAR(200) NOT NULL,                 -- å±¥å†æ ‡é¢˜
    description NTEXT,                            -- è¯¦ç»†æè¿°
    cost DECIMAL(12,2),                           -- è´¹ç”¨
    supplier NVARCHAR(100),                       -- ä¾›åº”å•†/æ‰¿åŒ…å•†
    
    -- ç»´ä¿®ç›¸å…³
    fault_description NTEXT,                      -- æ•…éšœæè¿°
    repair_method NTEXT,                          -- ç»´ä¿®æ–¹æ³•
    replaced_parts NTEXT,                         -- æ›´æ¢éƒ¨ä»¶
    repair_person_id BIGINT,                      -- ç»´ä¿®äººå‘˜ID
    
    -- é™„ä»¶
    attachment_urls NTEXT,                        -- é™„ä»¶URLåˆ—è¡¨(JSON)
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

### 3. èƒ½æºç®¡ç†æ¨¡å—

#### 3.1 èƒ½æºæ¶ˆè€—è®°å½•è¡¨ (coal_energy_consumption)
```sql
CREATE TABLE coal_energy_consumption (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    record_date DATE NOT NULL,                    -- è®°å½•æ—¥æœŸ
    shift_id BIGINT NOT NULL,                     -- ç­æ¬¡ID
    energy_type TINYINT NOT NULL,                 -- èƒ½æºç±»å‹ï¼š1ç”µ 2æ°´ 3ä»‹è´¨ 4è¯å‰‚ 5æ²¹æ–™
    
    -- æ¶ˆè€—æ•°æ®
    consumption_amount DECIMAL(12,2),             -- æ¶ˆè€—é‡
    unit NVARCHAR(20),                            -- å•ä½
    unit_price DECIMAL(8,4),                      -- å•ä»·
    total_cost DECIMAL(12,2),                     -- æ€»è´¹ç”¨
    
    -- è®¡é‡ä¿¡æ¯
    meter_reading_start DECIMAL(12,2),            -- èµ·å§‹è¯»æ•°
    meter_reading_end DECIMAL(12,2),              -- ç»“æŸè¯»æ•°
    meter_id NVARCHAR(50),                        -- è®¡é‡è¡¨ç¼–å·
    
    -- å½•å…¥ä¿¡æ¯
    recorder_id BIGINT,                           -- è®°å½•äººID
    record_time DATETIME,                         -- è®°å½•æ—¶é—´
    data_source TINYINT DEFAULT 1,                -- æ•°æ®æ¥æºï¼š1äººå·¥å½•å…¥ 2è‡ªåŠ¨é‡‡é›†
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

---

## ğŸ”§ åç«¯å¼€å‘åŠŸèƒ½è¯¦è§£

### 1. ç”Ÿäº§è°ƒåº¦ç®¡ç†æ¨¡å— (yudao-module-coal-production)

#### 1.1 ç”Ÿäº§è®¡åˆ’ç®¡ç†
**Controller æ¥å£ï¼š**
- `POST /coal/production/plan/create` - åˆ›å»ºç”Ÿäº§è®¡åˆ’
- `PUT /coal/production/plan/update` - æ›´æ–°ç”Ÿäº§è®¡åˆ’
- `DELETE /coal/production/plan/delete` - åˆ é™¤ç”Ÿäº§è®¡åˆ’
- `GET /coal/production/plan/page` - åˆ†é¡µæŸ¥è¯¢ç”Ÿäº§è®¡åˆ’
- `GET /coal/production/plan/get/{id}` - è·å–è®¡åˆ’è¯¦æƒ…
- `POST /coal/production/plan/approve` - å®¡æ‰¹ç”Ÿäº§è®¡åˆ’
- `POST /coal/production/plan/split` - æ‹†åˆ†è®¡åˆ’(å¹´åº¦â†’æœˆåº¦â†’æ—¥è®¡åˆ’)

**Service ä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class ProductionPlanServiceImpl extends ServiceExceptionUtil implements ProductionPlanService {
    
    /**
     * åˆ›å»ºç”Ÿäº§è®¡åˆ’
     */
    @Override
    @Transactional
    public Long createPlan(PlanCreateReqVO reqVO) {
        // 1. æ ¡éªŒè®¡åˆ’æ—¶é—´ä¸å†²çª
        validatePlanTimeConflict(reqVO);
        
        // 2. æ ¡éªŒè®¡åˆ’æ•°æ®åˆç†æ€§
        validatePlanData(reqVO);
        
        // 3. åˆ›å»ºè®¡åˆ’
        ProductionPlanDO plan = BeanUtils.toBean(reqVO, ProductionPlanDO.class);
        plan.setPlanCode(generatePlanCode(reqVO.getPlanType()));
        plan.setPlanStatus(PlanStatusEnum.PENDING.getStatus());
        
        productionPlanMapper.insert(plan);
        return plan.getId();
    }
    
    /**
     * æ‹†åˆ†è®¡åˆ’
     */
    @Override
    @Transactional
    public void splitPlan(Long planId, PlanSplitReqVO reqVO) {
        // 1. è·å–çˆ¶è®¡åˆ’
        ProductionPlanDO parentPlan = validatePlanExists(planId);
        
        // 2. æ ¹æ®æ‹†åˆ†ç±»å‹ç”Ÿæˆå­è®¡åˆ’
        List<ProductionPlanDO> childPlans = generateChildPlans(parentPlan, reqVO);
        
        // 3. æ‰¹é‡æ’å…¥å­è®¡åˆ’
        productionPlanMapper.insertBatch(childPlans);
    }
}
```

#### 1.2 äº§é‡ç»Ÿè®¡åˆ†æ
**Service ä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class ProductionStatisticsServiceImpl implements ProductionStatisticsService {
    
    /**
     * ç”Ÿæˆäº§å“å¹³è¡¡è¡¨
     */
    @Override
    public ProductBalanceVO generateProductBalance(ProductBalanceReqVO reqVO) {
        // 1. æŸ¥è¯¢æ—¶é—´æ®µå†…çš„äº§é‡æ•°æ®
        List<ProductionOutputDO> outputs = productionOutputMapper.selectByDateRange(
            reqVO.getStartDate(), reqVO.getEndDate());
        
        // 2. è®¡ç®—å¹³è¡¡æ•°æ®
        ProductBalanceVO balance = calculateProductBalance(outputs);
        
        // 3. è®¡ç®—å®Œæˆç‡
        calculateCompletionRate(balance, reqVO);
        
        return balance;
    }
    
    /**
     * ç”Ÿæˆäº§ç‡åˆ†ææŠ¥å‘Š
     */
    @Override
    public YieldAnalysisVO analyzeYield(YieldAnalysisReqVO reqVO) {
        // 1. æŸ¥è¯¢äº§é‡æ•°æ®
        List<ProductionOutputDO> outputs = getOutputsByCondition(reqVO);
        
        // 2. è®¡ç®—å„ç§äº§ç‡
        YieldAnalysisVO analysis = new YieldAnalysisVO();
        analysis.setCleanCoalYield(calculateCleanCoalYield(outputs));
        analysis.setRecoveryRate(calculateRecoveryRate(outputs));
        analysis.setRejectRate(calculateRejectRate(outputs));
        
        // 3. å¯¹æ¯”ç›®æ ‡äº§ç‡
        compareWithTarget(analysis, reqVO);
        
        return analysis;
    }
}
```

### 2. è®¾å¤‡ç®¡ç†æ¨¡å— (yudao-module-coal-equipment)

#### 2.1 è®¾å¤‡æ¡£æ¡ˆç®¡ç†
**Controller æ¥å£ï¼š**
- `POST /coal/equipment/create` - åˆ›å»ºè®¾å¤‡æ¡£æ¡ˆ
- `PUT /coal/equipment/update` - æ›´æ–°è®¾å¤‡ä¿¡æ¯
- `GET /coal/equipment/page` - åˆ†é¡µæŸ¥è¯¢è®¾å¤‡
- `GET /coal/equipment/get/{id}` - è·å–è®¾å¤‡è¯¦æƒ…
- `GET /coal/equipment/qrcode/{code}` - é€šè¿‡äºŒç»´ç è·å–è®¾å¤‡ä¿¡æ¯
- `POST /coal/equipment/upload-document` - ä¸Šä¼ è®¾å¤‡æ–‡æ¡£

#### 2.2 è®¾å¤‡KPIç»Ÿè®¡
**Service ä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class EquipmentKpiServiceImpl implements EquipmentKpiService {
    
    /**
     * è®¡ç®—è®¾å¤‡å®Œå¥½ç‡
     */
    @Override
    public BigDecimal calculateIntactRate(KpiCalculateReqVO reqVO) {
        // å®Œå¥½ç‡ = å®Œå¥½è®¾å¤‡æ•° / æ€»è®¾å¤‡æ•° * 100%
        long totalCount = equipmentMapper.countByCondition(reqVO);
        long intactCount = equipmentMapper.countByStatus(reqVO, EquipmentStatusEnum.NORMAL);
        
        return BigDecimal.valueOf(intactCount)
                .divide(BigDecimal.valueOf(totalCount), 4, RoundingMode.HALF_UP)
                .multiply(BigDecimal.valueOf(100));
    }
    
    /**
     * è®¡ç®—è®¾å¤‡åˆ©ç”¨ç‡
     */
    @Override
    public BigDecimal calculateUtilizationRate(KpiCalculateReqVO reqVO) {
        // åˆ©ç”¨ç‡ = å®é™…è¿è¡Œæ—¶é—´ / è®¡åˆ’è¿è¡Œæ—¶é—´ * 100%
        BigDecimal actualRunTime = getActualRunTime(reqVO);
        BigDecimal plannedRunTime = getPlannedRunTime(reqVO);
        
        return actualRunTime.divide(plannedRunTime, 4, RoundingMode.HALF_UP)
                .multiply(BigDecimal.valueOf(100));
    }
}
```

### 3. ç…¤è´¨ç®¡ç†æ¨¡å— (yudao-module-coal-quality)

#### 3.1 ç…¤è´¨æ£€æµ‹æ•°æ®ç®¡ç†
**Controller æ¥å£ï¼š**
- `POST /coal/quality/test-data/create` - å½•å…¥æ£€æµ‹æ•°æ®
- `GET /coal/quality/test-data/page` - åˆ†é¡µæŸ¥è¯¢æ£€æµ‹æ•°æ®
- `GET /coal/quality/test-data/realtime` - è·å–å®æ—¶æ£€æµ‹æ•°æ®
- `POST /coal/quality/test-data/batch-import` - æ‰¹é‡å¯¼å…¥æ£€æµ‹æ•°æ®

---

## ğŸ¨ å‰ç«¯å¼€å‘åŠŸèƒ½è¯¦è§£

### 1. ç”Ÿäº§è°ƒåº¦ç®¡ç†å‰ç«¯

#### 1.1 ç”Ÿäº§è®¡åˆ’ç®¡ç†é¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/production/plan/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è®¡åˆ’åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒå¹´åº¦/æœˆåº¦/æ—¥è®¡åˆ’åˆ‡æ¢ï¼‰
- è®¡åˆ’åˆ›å»ºè¡¨å•ï¼ˆæ”¯æŒæ¨¡æ¿é€‰æ‹©ï¼‰
- è®¡åˆ’æ‹†åˆ†åŠŸèƒ½ï¼ˆå¹´åº¦â†’æœˆåº¦â†’æ—¥è®¡åˆ’ï¼‰
- è®¡åˆ’å®¡æ‰¹æµç¨‹
- è®¡åˆ’æ‰§è¡Œè¿›åº¦è·Ÿè¸ª
- è®¡åˆ’å¯¹æ¯”åˆ†æå›¾è¡¨

**å…³é”®ç»„ä»¶ï¼š**
```vue
<template>
  <div class="production-plan">
    <!-- è®¡åˆ’ç±»å‹åˆ‡æ¢ -->
    <el-tabs v-model="activeTab" @tab-click="handleTabClick">
      <el-tab-pane label="å¹´åº¦è®¡åˆ’" name="yearly" />
      <el-tab-pane label="æœˆåº¦è®¡åˆ’" name="monthly" />
      <el-tab-pane label="æ—¥è®¡åˆ’" name="daily" />
    </el-tabs>
    
    <!-- æœç´¢æ¡ä»¶ -->
    <el-form :model="queryParams" inline>
      <el-form-item label="è®¡åˆ’å¹´åº¦">
        <el-date-picker v-model="queryParams.planYear" type="year" />
      </el-form-item>
      <el-form-item label="å®¡æ‰¹çŠ¶æ€">
        <el-select v-model="queryParams.planStatus">
          <el-option label="å¾…å®¡æ‰¹" value="1" />
          <el-option label="å·²å®¡æ‰¹" value="2" />
        </el-select>
      </el-form-item>
    </el-form>
    
    <!-- è®¡åˆ’åˆ—è¡¨ -->
    <el-table :data="planList" v-loading="loading">
      <el-table-column prop="planCode" label="è®¡åˆ’ç¼–å·" />
      <el-table-column prop="planYear" label="è®¡åˆ’å¹´åº¦" />
      <el-table-column prop="rawCoalPlan" label="è®¡åˆ’å…¥æ´—é‡(å¨)" />
      <el-table-column prop="cleanCoalPlan" label="è®¡åˆ’ç²¾ç…¤äº§é‡(å¨)" />
      <el-table-column label="å®Œæˆç‡">
        <template #default="{ row }">
          <el-progress :percentage="row.completionRate" />
        </template>
      </el-table-column>
      <el-table-column label="æ“ä½œ">
        <template #default="{ row }">
          <el-button @click="handleEdit(row)">ç¼–è¾‘</el-button>
          <el-button @click="handleSplit(row)">æ‹†åˆ†</el-button>
          <el-button @click="handleApprove(row)">å®¡æ‰¹</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>
```

#### 1.2 ç”Ÿäº§çœ‹æ¿é¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/production/dashboard/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- å®æ—¶ç”Ÿäº§æ•°æ®å±•ç¤º
- äº§é‡å®Œæˆæƒ…å†µå›¾è¡¨
- è®¾å¤‡è¿è¡ŒçŠ¶æ€ç›‘æ§
- è´¨é‡æŒ‡æ ‡è¶‹åŠ¿å›¾
- å¼‚å¸¸æŠ¥è­¦æé†’

### 2. è®¾å¤‡ç®¡ç†å‰ç«¯

#### 2.1 è®¾å¤‡æ¡£æ¡ˆé¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/equipment/archive/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è®¾å¤‡æ ‘å½¢ç»“æ„å±•ç¤º
- è®¾å¤‡è¯¦ç»†ä¿¡æ¯æŸ¥çœ‹
- è®¾å¤‡äºŒç»´ç ç”Ÿæˆ
- è®¾å¤‡æ–‡æ¡£ç®¡ç†
- è®¾å¤‡å±¥å†è®°å½•

#### 2.2 è®¾å¤‡KPIçœ‹æ¿
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/equipment/kpi/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- KPIæŒ‡æ ‡å¡ç‰‡å±•ç¤º
- è®¾å¤‡å®Œå¥½ç‡è¶‹åŠ¿å›¾
- æ•…éšœç‡ç»Ÿè®¡å›¾è¡¨
- è®¾å¤‡åˆ©ç”¨ç‡åˆ†æ
- å¯¹æ¯”åˆ†æåŠŸèƒ½

---

## ğŸ“± ç§»åŠ¨ç«¯å¼€å‘

### 1. è®¾å¤‡å·¡æ£€APP
**æŠ€æœ¯æ ˆï¼š** uni-app + Vue 3

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æ‰«ç æŸ¥çœ‹è®¾å¤‡æ¡£æ¡ˆ
- è®¾å¤‡å·¡æ£€è®°å½•
- æ•…éšœæŠ¥ä¿®æäº¤
- æ£€ä¿®ä»»åŠ¡æ¥æ”¶
- ç¦»çº¿æ•°æ®åŒæ­¥

### 2. ç”Ÿäº§æ•°æ®å½•å…¥APP
**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- äº§é‡æ•°æ®å½•å…¥
- ç…¤è´¨æ£€æµ‹æ•°æ®å½•å…¥
- èƒ½æºæ¶ˆè€—è®°å½•
- è°ƒåº¦è®°å½•å¡«å†™

---

## ğŸ”„ ç³»ç»Ÿé›†æˆæ–¹æ¡ˆ

### 1. PLCæ•°æ®é‡‡é›†
**æŠ€æœ¯æ–¹æ¡ˆï¼š** OPC UA + MQTT

**é‡‡é›†å†…å®¹ï¼š**
- è®¾å¤‡è¿è¡ŒçŠ¶æ€
- ç”Ÿäº§è¿‡ç¨‹æ•°æ®
- æŠ¥è­¦ä¿¡æ¯
- èƒ½æºæ¶ˆè€—æ•°æ®

### 2. ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆ
- **ERPç³»ç»Ÿ**ï¼šç”Ÿäº§è®¡åˆ’ã€ç‰©æ–™ç®¡ç†
- **åŒ–éªŒç³»ç»Ÿ**ï¼šç…¤è´¨æ£€æµ‹æ•°æ®
- **è§†é¢‘ç›‘æ§**ï¼šå®‰å…¨ç›‘æ§é›†æˆ
- **é—¨ç¦ç³»ç»Ÿ**ï¼šäººå‘˜è¿›å‡ºè®°å½•

---

## ğŸ“Š æŠ¥è¡¨ç³»ç»Ÿè®¾è®¡

### 1. ç”Ÿäº§æŠ¥è¡¨
- æ—¥äº§é‡æŠ¥è¡¨
- æœˆåº¦ç”Ÿäº§æ€»ç»“
- äº§å“å¹³è¡¡è¡¨
- äº§ç‡åˆ†ææŠ¥è¡¨

### 2. è®¾å¤‡æŠ¥è¡¨
- è®¾å¤‡è¿è¡ŒæŠ¥è¡¨
- æ•…éšœç»Ÿè®¡æŠ¥è¡¨
- ç»´ä¿®è®°å½•æŠ¥è¡¨
- KPIåˆ†ææŠ¥è¡¨

### 3. è´¨é‡æŠ¥è¡¨
- ç…¤è´¨æ£€æµ‹æŠ¥è¡¨
- è´¨é‡è¶‹åŠ¿åˆ†æ
- åˆæ ¼ç‡ç»Ÿè®¡
- è´¨é‡å¼‚å¸¸æŠ¥å‘Š

---

## ğŸš€ å¼€å‘è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2ä¸ªæœˆï¼‰
1. åŸºç¡€æ¡†æ¶æ­å»º
2. æ•°æ®åº“è®¾è®¡å®ç°
3. ç”¨æˆ·æƒé™ç®¡ç†
4. ç”Ÿäº§è®¡åˆ’ç®¡ç†æ¨¡å—

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-3ä¸ªæœˆï¼‰
1. äº§é‡ç»Ÿè®¡æ¨¡å—
2. è®¾å¤‡æ¡£æ¡ˆç®¡ç†
3. åŸºç¡€æŠ¥è¡¨åŠŸèƒ½
4. ç§»åŠ¨ç«¯æ¡†æ¶

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ3-4ä¸ªæœˆï¼‰
1. ç…¤è´¨ç®¡ç†æ¨¡å—
2. å®‰å…¨ç®¡ç†æ¨¡å—
3. èƒ½æºç®¡ç†æ¨¡å—
4. é«˜çº§æŠ¥è¡¨å’Œåˆ†æ

### ç¬¬å››é˜¶æ®µï¼ˆ4-5ä¸ªæœˆï¼‰
1. PLCæ•°æ®é›†æˆ
2. ç§»åŠ¨ç«¯å®Œå–„
3. ç³»ç»Ÿä¼˜åŒ–
4. éƒ¨ç½²ä¸Šçº¿

---

## ğŸ“‹ å¼€å‘è§„èŒƒ

### 1. ä»£ç è§„èŒƒ
- éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ
- ä½¿ç”¨ESLintè¿›è¡Œå‰ç«¯ä»£ç æ£€æŸ¥
- ç»Ÿä¸€çš„æ³¨é‡Šè§„èŒƒ
- Gitæäº¤è§„èŒƒ

### 2. æ•°æ®åº“è§„èŒƒ
- ç»Ÿä¸€çš„å‘½åè§„èŒƒ
- å®Œæ•´çš„ç´¢å¼•è®¾è®¡
- æ•°æ®å­—å…¸ç»´æŠ¤
- å¤‡ä»½æ¢å¤ç­–ç•¥

### 3. æ¥å£è§„èŒƒ
- RESTful APIè®¾è®¡
- ç»Ÿä¸€çš„è¿”å›æ ¼å¼
- å®Œæ•´çš„æ¥å£æ–‡æ¡£
- ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

### 4. å®‰å…¨ç®¡ç†æ¨¡å—æ•°æ®è¡¨

#### 4.1 å®‰å…¨æ£€æŸ¥è¡¨ (coal_safety_inspection)
```sql
CREATE TABLE coal_safety_inspection (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    inspection_code NVARCHAR(50) NOT NULL,        -- æ£€æŸ¥ç¼–å·
    inspection_date DATE NOT NULL,                -- æ£€æŸ¥æ—¥æœŸ
    inspection_type TINYINT NOT NULL,             -- æ£€æŸ¥ç±»å‹ï¼š1æ—¥æ£€ 2å‘¨æ£€ 3æœˆæ£€ 4ä¸“é¡¹æ£€æŸ¥
    inspector_id BIGINT NOT NULL,                 -- æ£€æŸ¥äººID

    -- æ£€æŸ¥åŒºåŸŸ
    area_id BIGINT,                               -- æ£€æŸ¥åŒºåŸŸID
    equipment_id BIGINT,                          -- æ£€æŸ¥è®¾å¤‡ID

    -- æ£€æŸ¥å†…å®¹
    inspection_items NTEXT,                       -- æ£€æŸ¥é¡¹ç›®(JSONæ ¼å¼)
    risk_level TINYINT,                           -- é£é™©ç­‰çº§ï¼š1ä½ 2ä¸­ 3é«˜ 4æé«˜

    -- å‘ç°é—®é¢˜
    problem_description NTEXT,                    -- é—®é¢˜æè¿°
    problem_photos NTEXT,                         -- é—®é¢˜ç…§ç‰‡(JSONæ•°ç»„)
    problem_videos NTEXT,                         -- é—®é¢˜è§†é¢‘(JSONæ•°ç»„)
    voice_record NVARCHAR(500),                   -- è¯­éŸ³è®°å½•URL

    -- æ•´æ”¹è¦æ±‚
    rectification_requirement NTEXT,             -- æ•´æ”¹è¦æ±‚
    rectification_deadline DATE,                 -- æ•´æ”¹æœŸé™
    rectification_person_id BIGINT,              -- æ•´æ”¹è´£ä»»äººID

    -- æ£€æŸ¥çŠ¶æ€
    inspection_status TINYINT DEFAULT 1,          -- æ£€æŸ¥çŠ¶æ€ï¼š1å¾…æ•´æ”¹ 2æ•´æ”¹ä¸­ 3å·²æ•´æ”¹ 4å·²éªŒæ”¶

    -- æ•´æ”¹ç»“æœ
    rectification_result NTEXT,                  -- æ•´æ”¹ç»“æœ
    rectification_photos NTEXT,                  -- æ•´æ”¹ç…§ç‰‡
    rectification_date DATE,                     -- æ•´æ”¹å®Œæˆæ—¥æœŸ
    verifier_id BIGINT,                          -- éªŒæ”¶äººID
    verify_date DATE,                            -- éªŒæ”¶æ—¥æœŸ

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 4.2 å®‰å…¨äº‹æ•…è¡¨ (coal_safety_accident)
```sql
CREATE TABLE coal_safety_accident (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    accident_code NVARCHAR(50) NOT NULL,          -- äº‹æ•…ç¼–å·
    accident_date DATETIME NOT NULL,              -- äº‹æ•…å‘ç”Ÿæ—¶é—´
    accident_type TINYINT NOT NULL,               -- äº‹æ•…ç±»å‹ï¼š1äººèº«ä¼¤å®³ 2è®¾å¤‡äº‹æ•… 3ç«ç¾ 4å…¶ä»–
    accident_level TINYINT NOT NULL,              -- äº‹æ•…ç­‰çº§ï¼š1è½»å¾® 2ä¸€èˆ¬ 3è¾ƒå¤§ 4é‡å¤§

    -- äº‹æ•…åœ°ç‚¹
    accident_location NVARCHAR(200),              -- äº‹æ•…åœ°ç‚¹
    equipment_id BIGINT,                          -- ç›¸å…³è®¾å¤‡ID

    -- äº‹æ•…æè¿°
    accident_description NTEXT NOT NULL,          -- äº‹æ•…ç»è¿‡
    accident_cause NTEXT,                         -- äº‹æ•…åŸå› 
    accident_photos NTEXT,                        -- äº‹æ•…ç°åœºç…§ç‰‡
    accident_videos NTEXT,                        -- äº‹æ•…ç°åœºè§†é¢‘

    -- äººå‘˜ä¼¤äº¡
    injured_count INT DEFAULT 0,                  -- å—ä¼¤äººæ•°
    death_count INT DEFAULT 0,                    -- æ­»äº¡äººæ•°
    injured_persons NTEXT,                        -- å—ä¼¤äººå‘˜ä¿¡æ¯(JSON)

    -- ç»æµæŸå¤±
    direct_loss DECIMAL(12,2) DEFAULT 0,          -- ç›´æ¥ç»æµæŸå¤±
    indirect_loss DECIMAL(12,2) DEFAULT 0,        -- é—´æ¥ç»æµæŸå¤±

    -- åº”æ€¥å¤„ç†
    emergency_measures NTEXT,                     -- åº”æ€¥å¤„ç†æªæ–½
    rescue_persons NTEXT,                         -- æ•‘æ´äººå‘˜

    -- äº‹æ•…è°ƒæŸ¥
    investigation_team NTEXT,                     -- è°ƒæŸ¥ç»„æˆå‘˜
    investigation_report NTEXT,                   -- è°ƒæŸ¥æŠ¥å‘Š
    responsibility_analysis NTEXT,                -- è´£ä»»åˆ†æ

    -- æ•´æ”¹æªæ–½
    corrective_measures NTEXT,                    -- çº æ­£æªæ–½
    preventive_measures NTEXT,                    -- é¢„é˜²æªæ–½

    -- å¤„ç†çŠ¶æ€
    handle_status TINYINT DEFAULT 1,              -- å¤„ç†çŠ¶æ€ï¼š1å¾…å¤„ç† 2å¤„ç†ä¸­ 3å·²å¤„ç† 4å·²ç»“æ¡ˆ

    -- æŠ¥å‘Šäºº
    reporter_id BIGINT,                           -- æŠ¥å‘ŠäººID
    report_time DATETIME,                         -- æŠ¥å‘Šæ—¶é—´

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

### 5. ç…¤è´¨ç®¡ç†æ¨¡å—æ•°æ®è¡¨

#### 5.1 ç…¤è´¨æ£€æµ‹æ•°æ®è¡¨ (coal_quality_test_data)
```sql
CREATE TABLE coal_quality_test_data (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    test_code NVARCHAR(50) NOT NULL,              -- æ£€æµ‹ç¼–å·
    test_date DATE NOT NULL,                      -- æ£€æµ‹æ—¥æœŸ
    shift_id BIGINT,                              -- ç­æ¬¡ID
    test_type TINYINT NOT NULL,                   -- æ£€æµ‹ç±»å‹ï¼š1å¿«ç° 2å¿«æ°´ 3å¿«æµ® 4ç­ç° 5å…¨åˆ†æ

    -- æ ·å“ä¿¡æ¯
    sample_source TINYINT NOT NULL,               -- æ ·å“æ¥æºï¼š1åŸç…¤ 2ç²¾ç…¤ 3ä¸­ç…¤ 4ç…¤æ³¥ 5çŸ¸çŸ³
    sample_location NVARCHAR(100),                -- å–æ ·åœ°ç‚¹
    sample_person_id BIGINT,                      -- å–æ ·äººID
    sample_time DATETIME,                         -- å–æ ·æ—¶é—´

    -- æ£€æµ‹é¡¹ç›®
    ash_content DECIMAL(5,2),                     -- ç°åˆ†(%)
    moisture_content DECIMAL(5,2),                -- æ°´åˆ†(%)
    volatile_matter DECIMAL(5,2),                 -- æŒ¥å‘åˆ†(%)
    fixed_carbon DECIMAL(5,2),                    -- å›ºå®šç¢³(%)
    sulfur_content DECIMAL(5,2),                  -- ç¡«åˆ†(%)
    calorific_value DECIMAL(8,2),                 -- å‘çƒ­é‡(cal/g)

    -- æµ®é€‰è¯•éªŒæ•°æ®
    float_test_density DECIMAL(4,2),              -- æµ®é€‰å¯†åº¦
    float_test_yield DECIMAL(5,2),                -- æµ®é€‰äº§ç‡(%)
    float_test_ash DECIMAL(5,2),                  -- æµ®é€‰ç°åˆ†(%)

    -- æ£€æµ‹äººå‘˜
    tester_id BIGINT,                             -- æ£€æµ‹äººå‘˜ID
    test_time DATETIME,                           -- æ£€æµ‹æ—¶é—´
    test_equipment NVARCHAR(100),                 -- æ£€æµ‹è®¾å¤‡

    -- æ£€æµ‹ç»“æœ
    test_result TINYINT DEFAULT 1,                -- æ£€æµ‹ç»“æœï¼š1åˆæ ¼ 2ä¸åˆæ ¼
    result_description NVARCHAR(500),             -- ç»“æœè¯´æ˜

    -- æ•°æ®æ¥æº
    data_source TINYINT DEFAULT 1,                -- æ•°æ®æ¥æºï¼š1äººå·¥å½•å…¥ 2è®¾å¤‡é‡‡é›† 3åŒ–éªŒå®¤

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 5.2 äº§å“é”€å”®è´¨é‡è¡¨ (coal_product_sales_quality)
```sql
CREATE TABLE coal_product_sales_quality (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    sales_date DATE NOT NULL,                     -- é”€å”®æ—¥æœŸ
    product_type TINYINT NOT NULL,                -- äº§å“ç±»å‹ï¼š1ç²¾ç…¤ 2ä¸­ç…¤ 3ç…¤æ³¥
    customer_id BIGINT,                           -- å®¢æˆ·ID
    transport_type TINYINT,                       -- è¿è¾“æ–¹å¼ï¼š1æ±½è¿ 2é“è¿ 3æ°´è¿

    -- é”€å”®æ•°é‡
    sales_quantity DECIMAL(10,2),                 -- é”€å”®æ•°é‡(å¨)
    unit_price DECIMAL(8,2),                      -- å•ä»·(å…ƒ/å¨)
    total_amount DECIMAL(12,2),                   -- æ€»é‡‘é¢

    -- è´¨é‡æŒ‡æ ‡
    ash_content DECIMAL(5,2),                     -- ç°åˆ†(%)
    moisture_content DECIMAL(5,2),                -- æ°´åˆ†(%)
    sulfur_content DECIMAL(5,2),                  -- ç¡«åˆ†(%)
    calorific_value DECIMAL(8,2),                 -- å‘çƒ­é‡(cal/g)

    -- è´¨é‡è¯„ä»·
    quality_grade NVARCHAR(20),                   -- è´¨é‡ç­‰çº§
    is_qualified BIT DEFAULT 1,                   -- æ˜¯å¦åˆæ ¼
    quality_feedback NTEXT,                       -- å®¢æˆ·è´¨é‡åé¦ˆ

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

### 6. ç³»ç»ŸåŸºç¡€æ•°æ®è¡¨

#### 6.1 ç”Ÿäº§ç³»ç»Ÿè¡¨ (coal_production_system)
```sql
CREATE TABLE coal_production_system (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    system_name NVARCHAR(100) NOT NULL,           -- ç³»ç»Ÿåç§°
    system_code NVARCHAR(50) NOT NULL,            -- ç³»ç»Ÿç¼–ç 
    system_type TINYINT NOT NULL,                 -- ç³»ç»Ÿç±»å‹ï¼š1ä¸»æ´—ç³»ç»Ÿ 2æµ®é€‰ç³»ç»Ÿ 3å‹æ»¤ç³»ç»Ÿ
    design_capacity DECIMAL(10,2),                -- è®¾è®¡å¤„ç†èƒ½åŠ›(t/h)

    -- å·¥è‰ºå‚æ•°
    process_flow NTEXT,                           -- å·¥è‰ºæµç¨‹æè¿°
    key_equipment NTEXT,                          -- å…³é”®è®¾å¤‡åˆ—è¡¨(JSON)

    -- ç³»ç»ŸçŠ¶æ€
    system_status TINYINT DEFAULT 1,              -- ç³»ç»ŸçŠ¶æ€ï¼š1æ­£å¸¸ 2æ•…éšœ 3æ£€ä¿® 4åœç”¨

    -- è´Ÿè´£äºº
    manager_id BIGINT,                            -- ç³»ç»Ÿè´Ÿè´£äººID
    operator_ids NTEXT,                           -- æ“ä½œäººå‘˜IDåˆ—è¡¨(JSON)

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 6.2 è½¦é—´éƒ¨é—¨è¡¨ (coal_workshop)
```sql
CREATE TABLE coal_workshop (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    workshop_name NVARCHAR(100) NOT NULL,         -- è½¦é—´åç§°
    workshop_code NVARCHAR(50) NOT NULL,          -- è½¦é—´ç¼–ç 
    workshop_type TINYINT NOT NULL,               -- è½¦é—´ç±»å‹ï¼š1ç”Ÿäº§è½¦é—´ 2è¾…åŠ©è½¦é—´ 3ç®¡ç†éƒ¨é—¨
    parent_id BIGINT DEFAULT 0,                   -- çˆ¶çº§éƒ¨é—¨ID

    -- è½¦é—´ä¿¡æ¯
    description NVARCHAR(500),                    -- è½¦é—´æè¿°
    location NVARCHAR(200),                       -- è½¦é—´ä½ç½®
    area_size DECIMAL(10,2),                      -- è½¦é—´é¢ç§¯(mÂ²)

    -- è´Ÿè´£äºº
    manager_id BIGINT,                            -- è½¦é—´ä¸»ä»»ID
    deputy_manager_id BIGINT,                     -- å‰¯ä¸»ä»»ID

    -- è”ç³»æ–¹å¼
    phone NVARCHAR(20),                           -- è”ç³»ç”µè¯
    email NVARCHAR(100),                          -- é‚®ç®±

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

---

## ğŸ”§ åç«¯å¼€å‘åŠŸèƒ½è¯¦è§£ï¼ˆç»­ï¼‰

### 4. å®‰å…¨ç®¡ç†æ¨¡å— (yudao-module-coal-safety)

#### 4.1 å®‰å…¨æ£€æŸ¥ç®¡ç†
**Controller æ¥å£ï¼š**
- `POST /coal/safety/inspection/create` - åˆ›å»ºå®‰å…¨æ£€æŸ¥è®°å½•
- `PUT /coal/safety/inspection/update` - æ›´æ–°æ£€æŸ¥è®°å½•
- `GET /coal/safety/inspection/page` - åˆ†é¡µæŸ¥è¯¢æ£€æŸ¥è®°å½•
- `POST /coal/safety/inspection/upload-media` - ä¸Šä¼ æ£€æŸ¥ç…§ç‰‡/è§†é¢‘
- `POST /coal/safety/inspection/rectify` - æäº¤æ•´æ”¹ç»“æœ
- `POST /coal/safety/inspection/verify` - éªŒæ”¶æ•´æ”¹ç»“æœ

**Service ä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class SafetyInspectionServiceImpl extends ServiceExceptionUtil implements SafetyInspectionService {

    /**
     * åˆ›å»ºå®‰å…¨æ£€æŸ¥è®°å½•
     */
    @Override
    @Transactional
    public Long createInspection(SafetyInspectionCreateReqVO reqVO) {
        // 1. ç”Ÿæˆæ£€æŸ¥ç¼–å·
        String inspectionCode = generateInspectionCode();

        // 2. åˆ›å»ºæ£€æŸ¥è®°å½•
        SafetyInspectionDO inspection = BeanUtils.toBean(reqVO, SafetyInspectionDO.class);
        inspection.setInspectionCode(inspectionCode);
        inspection.setInspectionStatus(InspectionStatusEnum.PENDING_RECTIFICATION.getStatus());

        safetyInspectionMapper.insert(inspection);

        // 3. å¦‚æœæœ‰é—®é¢˜ï¼Œæ¨é€æ•´æ”¹é€šçŸ¥
        if (CollUtil.isNotEmpty(reqVO.getProblems())) {
            pushRectificationNotice(inspection);
        }

        return inspection.getId();
    }

    /**
     * æ¨é€æ•´æ”¹é€šçŸ¥
     */
    private void pushRectificationNotice(SafetyInspectionDO inspection) {
        // æ„å»ºé€šçŸ¥å†…å®¹
        NotificationReqVO notification = new NotificationReqVO();
        notification.setTitle("å®‰å…¨æ£€æŸ¥æ•´æ”¹é€šçŸ¥");
        notification.setContent(String.format("æ£€æŸ¥ç¼–å·ï¼š%sï¼Œè¯·åŠæ—¶æ•´æ”¹", inspection.getInspectionCode()));
        notification.setRecipientId(inspection.getRectificationPersonId());
        notification.setType(NotificationTypeEnum.SAFETY_RECTIFICATION.getType());

        // å‘é€é€šçŸ¥
        notificationService.sendNotification(notification);
    }
}
```

#### 4.2 äº‹æ•…ç®¡ç†
**Service ä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class SafetyAccidentServiceImpl extends ServiceExceptionUtil implements SafetyAccidentService {

    /**
     * åˆ›å»ºäº‹æ•…è®°å½•
     */
    @Override
    @Transactional
    public Long createAccident(SafetyAccidentCreateReqVO reqVO) {
        // 1. ç”Ÿæˆäº‹æ•…ç¼–å·
        String accidentCode = generateAccidentCode(reqVO.getAccidentLevel());

        // 2. åˆ›å»ºäº‹æ•…è®°å½•
        SafetyAccidentDO accident = BeanUtils.toBean(reqVO, SafetyAccidentDO.class);
        accident.setAccidentCode(accidentCode);
        accident.setHandleStatus(AccidentHandleStatusEnum.PENDING.getStatus());

        safetyAccidentMapper.insert(accident);

        // 3. æ ¹æ®äº‹æ•…ç­‰çº§æ¨é€ç´§æ€¥é€šçŸ¥
        pushEmergencyNotification(accident);

        // 4. è‡ªåŠ¨å¯åŠ¨åº”æ€¥é¢„æ¡ˆ
        if (accident.getAccidentLevel() >= AccidentLevelEnum.MAJOR.getLevel()) {
            emergencyPlanService.activateEmergencyPlan(accident.getId());
        }

        return accident.getId();
    }

    /**
     * äº‹æ•…ç»Ÿè®¡åˆ†æ
     */
    @Override
    public AccidentStatisticsVO getAccidentStatistics(AccidentStatisticsReqVO reqVO) {
        AccidentStatisticsVO statistics = new AccidentStatisticsVO();

        // 1. æŒ‰äº‹æ•…ç±»å‹ç»Ÿè®¡
        List<AccidentTypeStatisticsVO> typeStats = safetyAccidentMapper.statisticsByType(reqVO);
        statistics.setTypeStatistics(typeStats);

        // 2. æŒ‰äº‹æ•…ç­‰çº§ç»Ÿè®¡
        List<AccidentLevelStatisticsVO> levelStats = safetyAccidentMapper.statisticsByLevel(reqVO);
        statistics.setLevelStatistics(levelStats);

        // 3. äº‹æ•…è¶‹åŠ¿åˆ†æ
        List<AccidentTrendVO> trendData = safetyAccidentMapper.getAccidentTrend(reqVO);
        statistics.setTrendData(trendData);

        // 4. è®¡ç®—äº‹æ•…ç‡
        BigDecimal accidentRate = calculateAccidentRate(reqVO);
        statistics.setAccidentRate(accidentRate);

        return statistics;
    }
}
```

### 5. ç…¤è´¨ç®¡ç†æ¨¡å— (yudao-module-coal-quality)

#### 5.1 ç…¤è´¨æ£€æµ‹æ•°æ®ç®¡ç†
**Controller æ¥å£ï¼š**
- `POST /coal/quality/test-data/create` - å½•å…¥æ£€æµ‹æ•°æ®
- `PUT /coal/quality/test-data/update` - æ›´æ–°æ£€æµ‹æ•°æ®
- `GET /coal/quality/test-data/page` - åˆ†é¡µæŸ¥è¯¢æ£€æµ‹æ•°æ®
- `GET /coal/quality/test-data/realtime` - è·å–å®æ—¶æ£€æµ‹æ•°æ®
- `POST /coal/quality/test-data/batch-import` - æ‰¹é‡å¯¼å…¥æ£€æµ‹æ•°æ®
- `GET /coal/quality/test-data/export` - å¯¼å‡ºæ£€æµ‹æ•°æ®

**Service ä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class QualityTestDataServiceImpl extends ServiceExceptionUtil implements QualityTestDataService {

    /**
     * å½•å…¥æ£€æµ‹æ•°æ®
     */
    @Override
    @Transactional
    public Long createTestData(QualityTestDataCreateReqVO reqVO) {
        // 1. ç”Ÿæˆæ£€æµ‹ç¼–å·
        String testCode = generateTestCode(reqVO.getTestType());

        // 2. æ•°æ®æ ¡éªŒ
        validateTestData(reqVO);

        // 3. åˆ›å»ºæ£€æµ‹è®°å½•
        QualityTestDataDO testData = BeanUtils.toBean(reqVO, QualityTestDataDO.class);
        testData.setTestCode(testCode);

        // 4. è‡ªåŠ¨åˆ¤æ–­æ£€æµ‹ç»“æœ
        determineTestResult(testData);

        qualityTestDataMapper.insert(testData);

        // 5. å¦‚æœæ£€æµ‹ä¸åˆæ ¼ï¼Œå‘é€é¢„è­¦
        if (testData.getTestResult().equals(TestResultEnum.UNQUALIFIED.getResult())) {
            sendQualityAlert(testData);
        }

        return testData.getId();
    }

    /**
     * è´¨é‡ç»Ÿè®¡åˆ†æ
     */
    @Override
    public QualityStatisticsVO getQualityStatistics(QualityStatisticsReqVO reqVO) {
        QualityStatisticsVO statistics = new QualityStatisticsVO();

        // 1. ç°åˆ†ç»Ÿè®¡
        QualityTrendVO ashTrend = getQualityTrend(reqVO, "ash_content");
        statistics.setAshTrend(ashTrend);

        // 2. æ°´åˆ†ç»Ÿè®¡
        QualityTrendVO moistureTrend = getQualityTrend(reqVO, "moisture_content");
        statistics.setMoistureTrend(moistureTrend);

        // 3. åˆæ ¼ç‡ç»Ÿè®¡
        BigDecimal qualificationRate = calculateQualificationRate(reqVO);
        statistics.setQualificationRate(qualificationRate);

        // 4. ç¨³å®šæ€§åˆ†æ
        QualityStabilityVO stability = analyzeQualityStability(reqVO);
        statistics.setStability(stability);

        return statistics;
    }

    /**
     * è‡ªåŠ¨åˆ¤æ–­æ£€æµ‹ç»“æœ
     */
    private void determineTestResult(QualityTestDataDO testData) {
        // æ ¹æ®äº§å“æ ‡å‡†åˆ¤æ–­æ˜¯å¦åˆæ ¼
        ProductStandardDO standard = productStandardMapper.selectByProductType(testData.getSampleSource());

        boolean isQualified = true;

        // æ£€æŸ¥ç°åˆ†
        if (testData.getAshContent() != null && standard.getMaxAshContent() != null) {
            if (testData.getAshContent().compareTo(standard.getMaxAshContent()) > 0) {
                isQualified = false;
            }
        }

        // æ£€æŸ¥æ°´åˆ†
        if (testData.getMoistureContent() != null && standard.getMaxMoistureContent() != null) {
            if (testData.getMoistureContent().compareTo(standard.getMaxMoistureContent()) > 0) {
                isQualified = false;
            }
        }

        // æ£€æŸ¥ç¡«åˆ†
        if (testData.getSulfurContent() != null && standard.getMaxSulfurContent() != null) {
            if (testData.getSulfurContent().compareTo(standard.getMaxSulfurContent()) > 0) {
                isQualified = false;
            }
        }

        testData.setTestResult(isQualified ? TestResultEnum.QUALIFIED.getResult() : TestResultEnum.UNQUALIFIED.getResult());
    }
}
```

---

## ğŸ¨ å‰ç«¯å¼€å‘åŠŸèƒ½è¯¦è§£ï¼ˆç»­ï¼‰

### 3. å®‰å…¨ç®¡ç†å‰ç«¯

#### 3.1 å®‰å…¨æ£€æŸ¥é¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/safety/inspection/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- æ£€æŸ¥è®°å½•åˆ—è¡¨å±•ç¤º
- æ£€æŸ¥è¡¨å•å½•å…¥ï¼ˆæ”¯æŒæ‹ç…§ã€å½•éŸ³ã€å½•åƒï¼‰
- æ•´æ”¹ä»»åŠ¡åˆ†é…
- æ•´æ”¹è¿›åº¦è·Ÿè¸ª
- éªŒæ”¶ç»“æœç¡®è®¤

**å…³é”®ç»„ä»¶ï¼š**
```vue
<template>
  <div class="safety-inspection">
    <!-- æ£€æŸ¥è®°å½•è¡¨å• -->
    <el-form :model="inspectionForm" :rules="inspectionRules">
      <el-form-item label="æ£€æŸ¥ç±»å‹" prop="inspectionType">
        <el-select v-model="inspectionForm.inspectionType">
          <el-option label="æ—¥å¸¸æ£€æŸ¥" :value="1" />
          <el-option label="ä¸“é¡¹æ£€æŸ¥" :value="2" />
          <el-option label="éšæ‚£æ’æŸ¥" :value="3" />
        </el-select>
      </el-form-item>

      <el-form-item label="æ£€æŸ¥åŒºåŸŸ" prop="areaId">
        <el-cascader
          v-model="inspectionForm.areaId"
          :options="areaOptions"
          :props="{ checkStrictly: true }"
        />
      </el-form-item>

      <el-form-item label="é—®é¢˜æè¿°" prop="problemDescription">
        <el-input
          v-model="inspectionForm.problemDescription"
          type="textarea"
          :rows="4"
        />
      </el-form-item>

      <!-- å¤šåª’ä½“ä¸Šä¼  -->
      <el-form-item label="é—®é¢˜ç…§ç‰‡">
        <el-upload
          :action="uploadUrl"
          list-type="picture-card"
          :on-success="handlePhotoSuccess"
          :before-upload="beforePhotoUpload"
        >
          <el-icon><Plus /></el-icon>
        </el-upload>
      </el-form-item>

      <el-form-item label="è¯­éŸ³è®°å½•">
        <voice-recorder @on-record="handleVoiceRecord" />
      </el-form-item>

      <el-form-item label="æ•´æ”¹è¦æ±‚" prop="rectificationRequirement">
        <el-input
          v-model="inspectionForm.rectificationRequirement"
          type="textarea"
          :rows="3"
        />
      </el-form-item>

      <el-form-item label="æ•´æ”¹æœŸé™" prop="rectificationDeadline">
        <el-date-picker
          v-model="inspectionForm.rectificationDeadline"
          type="date"
        />
      </el-form-item>

      <el-form-item label="æ•´æ”¹è´£ä»»äºº" prop="rectificationPersonId">
        <user-selector v-model="inspectionForm.rectificationPersonId" />
      </el-form-item>
    </el-form>

    <!-- æ£€æŸ¥è®°å½•åˆ—è¡¨ -->
    <el-table :data="inspectionList" v-loading="loading">
      <el-table-column prop="inspectionCode" label="æ£€æŸ¥ç¼–å·" />
      <el-table-column prop="inspectionDate" label="æ£€æŸ¥æ—¥æœŸ" />
      <el-table-column prop="inspectionTypeName" label="æ£€æŸ¥ç±»å‹" />
      <el-table-column prop="riskLevelName" label="é£é™©ç­‰çº§">
        <template #default="{ row }">
          <el-tag :type="getRiskLevelType(row.riskLevel)">
            {{ row.riskLevelName }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="inspectionStatusName" label="çŠ¶æ€" />
      <el-table-column label="æ“ä½œ">
        <template #default="{ row }">
          <el-button @click="handleView(row)">æŸ¥çœ‹</el-button>
          <el-button
            v-if="row.inspectionStatus === 1"
            @click="handleRectify(row)"
          >
            æ•´æ”¹
          </el-button>
          <el-button
            v-if="row.inspectionStatus === 3"
            @click="handleVerify(row)"
          >
            éªŒæ”¶
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script lang="ts" setup>
import { ref, reactive, onMounted } from 'vue'
import * as SafetyApi from '@/api/coal/safety'
import VoiceRecorder from '@/components/VoiceRecorder/index.vue'
import UserSelector from '@/components/UserSelector/index.vue'

// å“åº”å¼æ•°æ®
const loading = ref(false)
const inspectionList = ref([])
const inspectionForm = reactive({
  inspectionType: null,
  areaId: null,
  problemDescription: '',
  rectificationRequirement: '',
  rectificationDeadline: null,
  rectificationPersonId: null
})

// è¡¨å•æ ¡éªŒè§„åˆ™
const inspectionRules = {
  inspectionType: [{ required: true, message: 'è¯·é€‰æ‹©æ£€æŸ¥ç±»å‹', trigger: 'change' }],
  areaId: [{ required: true, message: 'è¯·é€‰æ‹©æ£€æŸ¥åŒºåŸŸ', trigger: 'change' }],
  problemDescription: [{ required: true, message: 'è¯·è¾“å…¥é—®é¢˜æè¿°', trigger: 'blur' }]
}

// è·å–æ£€æŸ¥è®°å½•åˆ—è¡¨
const getInspectionList = async () => {
  loading.value = true
  try {
    const data = await SafetyApi.getInspectionPage(queryParams)
    inspectionList.value = data.list
  } finally {
    loading.value = false
  }
}

// å¤„ç†è¯­éŸ³è®°å½•
const handleVoiceRecord = (voiceUrl: string) => {
  inspectionForm.voiceRecord = voiceUrl
}

// é£é™©ç­‰çº§æ ·å¼
const getRiskLevelType = (level: number) => {
  const types = { 1: 'info', 2: 'warning', 3: 'danger', 4: 'danger' }
  return types[level] || 'info'
}

onMounted(() => {
  getInspectionList()
})
</script>
```

#### 3.2 å®‰å…¨çœ‹æ¿é¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/safety/dashboard/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- å®‰å…¨æŒ‡æ ‡å¡ç‰‡å±•ç¤º
- äº‹æ•…ç»Ÿè®¡å›¾è¡¨
- éšæ‚£æ•´æ”¹è¿›åº¦
- å®‰å…¨æ£€æŸ¥å®Œæˆç‡
- å®æ—¶å®‰å…¨çŠ¶æ€ç›‘æ§

### 4. ç…¤è´¨ç®¡ç†å‰ç«¯

#### 4.1 ç…¤è´¨æ£€æµ‹æ•°æ®å½•å…¥é¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/quality/test-data/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- æ£€æµ‹æ•°æ®å½•å…¥è¡¨å•
- æ£€æµ‹ç»“æœè‡ªåŠ¨åˆ¤æ–­
- å†å²æ£€æµ‹æ•°æ®æŸ¥è¯¢
- è´¨é‡è¶‹åŠ¿å›¾è¡¨å±•ç¤º
- ä¸åˆæ ¼æ•°æ®é¢„è­¦

#### 4.2 è´¨é‡ç»Ÿè®¡åˆ†æé¡µé¢
**é¡µé¢è·¯å¾„ï¼š** `src/views/coal/quality/statistics/index.vue`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- è´¨é‡æŒ‡æ ‡è¶‹åŠ¿å›¾
- åˆæ ¼ç‡ç»Ÿè®¡å›¾è¡¨
- è´¨é‡ç¨³å®šæ€§åˆ†æ
- äº§å“è´¨é‡å¯¹æ¯”
- è´¨é‡å¼‚å¸¸é¢„è­¦

---

## ğŸ“± ç§»åŠ¨ç«¯å¼€å‘è¯¦è§£

### 1. æŠ€æœ¯æ¶æ„
**æ¡†æ¶é€‰æ‹©ï¼š** uni-app + Vue 3 + TypeScript
**UIç»„ä»¶ï¼š** uni-ui + è‡ªå®šä¹‰ç»„ä»¶
**çŠ¶æ€ç®¡ç†ï¼š** Pinia
**ç½‘ç»œè¯·æ±‚ï¼š** uni.request å°è£…

### 2. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 2.1 è®¾å¤‡å·¡æ£€æ¨¡å—
```vue
<!-- pages/equipment/inspection/index.vue -->
<template>
  <view class="inspection-page">
    <!-- æ‰«ç å…¥å£ -->
    <view class="scan-section">
      <button @click="scanQRCode" class="scan-btn">
        <uni-icons type="scan" size="30"></uni-icons>
        <text>æ‰«ç å·¡æ£€</text>
      </button>
    </view>

    <!-- å·¡æ£€è¡¨å• -->
    <uni-forms :model="inspectionForm" :rules="rules" ref="form">
      <uni-forms-item label="è®¾å¤‡åç§°" name="equipmentName">
        <uni-easyinput v-model="inspectionForm.equipmentName" disabled />
      </uni-forms-item>

      <uni-forms-item label="å·¡æ£€é¡¹ç›®" name="inspectionItems">
        <view class="inspection-items">
          <view
            v-for="item in inspectionItems"
            :key="item.id"
            class="inspection-item"
          >
            <text>{{ item.name }}</text>
            <uni-data-checkbox
              v-model="item.result"
              :localdata="[{value: 1, text: 'æ­£å¸¸'}, {value: 0, text: 'å¼‚å¸¸'}]"
            />
          </view>
        </view>
      </uni-forms-item>

      <uni-forms-item label="å¼‚å¸¸æè¿°" name="abnormalDescription">
        <uni-easyinput
          v-model="inspectionForm.abnormalDescription"
          type="textarea"
          placeholder="è¯·æè¿°å‘ç°çš„å¼‚å¸¸æƒ…å†µ"
        />
      </uni-forms-item>

      <uni-forms-item label="ç°åœºç…§ç‰‡">
        <view class="photo-upload">
          <view
            v-for="(photo, index) in photos"
            :key="index"
            class="photo-item"
          >
            <image :src="photo" mode="aspectFill" />
            <view class="photo-delete" @click="deletePhoto(index)">
              <uni-icons type="clear" size="16" color="#fff" />
            </view>
          </view>
          <view class="photo-add" @click="chooseImage">
            <uni-icons type="camera" size="30" />
            <text>æ·»åŠ ç…§ç‰‡</text>
          </view>
        </view>
      </uni-forms-item>
    </uni-forms>

    <view class="submit-section">
      <button @click="submitInspection" class="submit-btn">æäº¤å·¡æ£€</button>
    </view>
  </view>
</template>

<script lang="ts" setup>
import { ref, reactive } from 'vue'
import * as EquipmentApi from '@/api/equipment'

// å“åº”å¼æ•°æ®
const inspectionForm = reactive({
  equipmentId: '',
  equipmentName: '',
  abnormalDescription: ''
})

const inspectionItems = ref([])
const photos = ref([])

// æ‰«ç åŠŸèƒ½
const scanQRCode = () => {
  uni.scanCode({
    success: async (res) => {
      try {
        // è§£æäºŒç»´ç è·å–è®¾å¤‡ä¿¡æ¯
        const equipmentInfo = await EquipmentApi.getEquipmentByQRCode(res.result)
        inspectionForm.equipmentId = equipmentInfo.id
        inspectionForm.equipmentName = equipmentInfo.name

        // è·å–å·¡æ£€é¡¹ç›®
        const items = await EquipmentApi.getInspectionItems(equipmentInfo.id)
        inspectionItems.value = items
      } catch (error) {
        uni.showToast({
          title: 'è®¾å¤‡ä¿¡æ¯è·å–å¤±è´¥',
          icon: 'error'
        })
      }
    }
  })
}

// é€‰æ‹©å›¾ç‰‡
const chooseImage = () => {
  uni.chooseImage({
    count: 9 - photos.value.length,
    success: (res) => {
      photos.value.push(...res.tempFilePaths)
    }
  })
}

// æäº¤å·¡æ£€
const submitInspection = async () => {
  try {
    // ä¸Šä¼ ç…§ç‰‡
    const photoUrls = await uploadPhotos()

    // æäº¤å·¡æ£€æ•°æ®
    const inspectionData = {
      ...inspectionForm,
      inspectionItems: inspectionItems.value,
      photos: photoUrls
    }

    await EquipmentApi.submitInspection(inspectionData)

    uni.showToast({
      title: 'æäº¤æˆåŠŸ',
      icon: 'success'
    })

    // è¿”å›ä¸Šä¸€é¡µ
    uni.navigateBack()
  } catch (error) {
    uni.showToast({
      title: 'æäº¤å¤±è´¥',
      icon: 'error'
    })
  }
}
</script>
```

#### 2.2 æ•…éšœæŠ¥ä¿®æ¨¡å—
```vue
<!-- pages/equipment/repair/index.vue -->
<template>
  <view class="repair-page">
    <uni-forms :model="repairForm" :rules="rules" ref="form">
      <uni-forms-item label="æ•…éšœè®¾å¤‡" name="equipmentId">
        <uni-data-select
          v-model="repairForm.equipmentId"
          :localdata="equipmentOptions"
          placeholder="è¯·é€‰æ‹©æ•…éšœè®¾å¤‡"
        />
      </uni-forms-item>

      <uni-forms-item label="æ•…éšœç±»å‹" name="faultType">
        <uni-data-checkbox
          v-model="repairForm.faultType"
          :localdata="faultTypeOptions"
        />
      </uni-forms-item>

      <uni-forms-item label="æ•…éšœæè¿°" name="faultDescription">
        <uni-easyinput
          v-model="repairForm.faultDescription"
          type="textarea"
          placeholder="è¯·è¯¦ç»†æè¿°æ•…éšœç°è±¡"
        />
      </uni-forms-item>

      <uni-forms-item label="ç´§æ€¥ç¨‹åº¦" name="urgencyLevel">
        <uni-data-checkbox
          v-model="repairForm.urgencyLevel"
          :localdata="urgencyOptions"
        />
      </uni-forms-item>

      <uni-forms-item label="ç°åœºç…§ç‰‡">
        <view class="media-upload">
          <view class="photo-section">
            <view
              v-for="(photo, index) in photos"
              :key="index"
              class="media-item"
            >
              <image :src="photo" mode="aspectFill" />
              <view class="media-delete" @click="deletePhoto(index)">Ã—</view>
            </view>
            <view class="media-add" @click="chooseImage">
              <uni-icons type="camera" size="30" />
              <text>æ‹ç…§</text>
            </view>
          </view>
        </view>
      </uni-forms-item>

      <uni-forms-item label="ç°åœºå½•éŸ³">
        <view class="voice-section">
          <button
            @click="startRecord"
            :disabled="isRecording"
            class="record-btn"
          >
            {{ isRecording ? 'å½•éŸ³ä¸­...' : 'å¼€å§‹å½•éŸ³' }}
          </button>
          <button
            @click="stopRecord"
            :disabled="!isRecording"
            class="stop-btn"
          >
            åœæ­¢å½•éŸ³
          </button>
          <view v-if="voiceUrl" class="voice-player">
            <button @click="playVoice">æ’­æ”¾å½•éŸ³</button>
          </view>
        </view>
      </uni-forms-item>
    </uni-forms>

    <view class="submit-section">
      <button @click="submitRepair" class="submit-btn">æäº¤æŠ¥ä¿®</button>
    </view>
  </view>
</template>

<script lang="ts" setup>
import { ref, reactive, onMounted } from 'vue'
import * as RepairApi from '@/api/repair'

// å“åº”å¼æ•°æ®
const repairForm = reactive({
  equipmentId: '',
  faultType: '',
  faultDescription: '',
  urgencyLevel: 1
})

const photos = ref([])
const voiceUrl = ref('')
const isRecording = ref(false)
const recorderManager = uni.getRecorderManager()

// å¼€å§‹å½•éŸ³
const startRecord = () => {
  isRecording.value = true
  recorderManager.start({
    duration: 60000, // æœ€é•¿60ç§’
    sampleRate: 16000,
    numberOfChannels: 1,
    encodeBitRate: 96000,
    format: 'mp3'
  })
}

// åœæ­¢å½•éŸ³
const stopRecord = () => {
  isRecording.value = false
  recorderManager.stop()
}

// å½•éŸ³äº‹ä»¶ç›‘å¬
recorderManager.onStop((res) => {
  voiceUrl.value = res.tempFilePath
})

// æäº¤æŠ¥ä¿®
const submitRepair = async () => {
  try {
    // ä¸Šä¼ ç…§ç‰‡å’Œå½•éŸ³
    const photoUrls = await uploadPhotos()
    const voiceFileUrl = voiceUrl.value ? await uploadVoice() : ''

    // æäº¤æŠ¥ä¿®æ•°æ®
    const repairData = {
      ...repairForm,
      photos: photoUrls,
      voiceUrl: voiceFileUrl
    }

    await RepairApi.submitRepair(repairData)

    uni.showToast({
      title: 'æŠ¥ä¿®æˆåŠŸ',
      icon: 'success'
    })

    uni.navigateBack()
  } catch (error) {
    uni.showToast({
      title: 'æŠ¥ä¿®å¤±è´¥',
      icon: 'error'
    })
  }
}
</script>
```

è¿™ä¸ªå¤§çº²æ¶µç›–äº†é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´å¼€å‘æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è¯¦ç»†çš„æ•°æ®åº“è®¾è®¡ã€åç«¯åŠŸèƒ½å¼€å‘ã€å‰ç«¯é¡µé¢å®ç°å’Œç§»åŠ¨ç«¯å¼€å‘ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¿™ä¸ªå¤§çº²é€æ­¥å®æ–½å¼€å‘ã€‚
