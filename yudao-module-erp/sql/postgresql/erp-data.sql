/*
 MySQL to PostgreSQL Data Migration Script

 Generated by: mysql_to_pgsql_converter.py
 Source: erp-2024-05-03.sql (MySQL)
 Target: PostgreSQL

 Tables included:
   (all tables)

 Usage:
   psql -U postgres -d ruoyi-vue-pro -f <this_file.sql>

 Or with password:
   PGPASSWORD=Pass1234 psql -h 127.0.0.1 -U postgres -d ruoyi-vue-pro -f <this_file.sql>

 IMPORTANT:
   Before running this script, you may need to run the corresponding
   upgrade script to fix column types (smallint -> boolean).
*/

-- Disable triggers during import for better performance
SET session_replication_role = replica;


BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
INSERT INTO erp_finance_payment (id, no, status, payment_time, finance_user_id, supplier_id, account_id, total_price, discount_price, payment_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (2, 'FKD20240214000001', 10, '2024-02-26 00:00:00', 112, 1, 1, 300.000000, 10.000000, 290.000000, '哈哈哈哈', '1', '2024-02-14 15:05:19', '1', '2024-02-14 09:00:22', true, 1), (3, 'FKD20240214000002', 10, '2024-02-20 00:00:00', NULL, 1, 1, -10.000000, 4.000000, -14.000000, NULL, '1', '2024-02-14 15:34:11', '1', '2024-02-14 09:00:18', true, 1), (4, 'FKD20240214000003', 10, '2024-02-18 00:00:00', NULL, 1, 1, 114.700000, 0.000000, 114.700000, NULL, '1', '2024-02-14 16:43:59', '1', '2024-02-14 08:58:43', true, 1), (5, 'FKD20240214000004', 10, '2024-02-19 00:00:00', NULL, 1, 1, 114.700000, 0.000000, 114.700000, NULL, '1', '2024-02-14 16:44:31', '1', '2024-02-14 08:55:13', true, 1), (6, 'FKD20240214000005', 10, '2024-02-19 00:00:00', NULL, 1, 1, -20.000000, 0.000000, -20.000000, NULL, '1', '2024-02-14 16:59:30', '1', '2024-02-14 09:00:16', true, 1), (7, 'FKD20240214000006', 10, '2024-02-20 00:00:00', NULL, 1, 1, -20.000000, 0.000000, -20.000000, NULL, '1', '2024-02-14 17:00:11', '1', '2024-02-14 09:00:41', true, 1), (8, 'FKD20240214000007', 10, '2024-02-20 00:00:00', 115, 1, 1, -20.000000, 0.000000, -20.000000, NULL, '1', '2024-02-14 17:01:27', '1', '2024-02-14 09:05:28', true, 1), (9, 'FKD20240214000008', 10, '2024-02-27 00:00:00', NULL, 1, 1, -143.200000, 0.000000, -143.200000, NULL, '1', '2024-02-14 17:04:03', '1', '2024-02-14 09:04:35', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_finance_payment_item (id, payment_id, biz_type, biz_id, biz_no, total_price, paid_price, payment_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (11, 2, 11, 16, 'CGRK20240213000001', 414.700000, 0.000000, 300.000000, '测试一下', '1', '2024-02-14 15:05:19', '1', '2024-02-14 09:00:22', true, 1), (12, 3, 12, 24, 'CGTH20240213000001', -163.200000, 0.000000, -10.000000, NULL, '1', '2024-02-14 15:34:11', '1', '2024-02-14 09:00:18', true, 1), (13, 4, 11, 16, 'CGRK20240213000001', 414.700000, 300.000000, 114.700000, NULL, '1', '2024-02-14 16:43:59', '1', '2024-02-14 08:58:43', true, 1), (14, 5, 11, 16, 'CGRK20240213000001', 414.700000, 300.000000, 114.700000, NULL, '1', '2024-02-14 16:44:31', '1', '2024-02-14 08:55:13', true, 1), (15, 6, 12, 24, 'CGTH20240213000001', -163.200000, -10.000000, -20.000000, NULL, '1', '2024-02-14 16:59:30', '1', '2024-02-14 09:00:16', true, 1), (16, 7, 12, 24, 'CGTH20240213000001', -163.200000, -10.000000, -20.000000, NULL, '1', '2024-02-14 17:00:11', '1', '2024-02-14 09:00:41', true, 1), (17, 8, 12, 24, 'CGTH20240213000001', -163.200000, 0.000000, -20.000000, NULL, '1', '2024-02-14 17:01:27', '1', '2024-02-14 09:05:29', true, 1), (18, 9, 12, 24, 'CGTH20240213000001', -163.200000, -20.000000, -143.200000, NULL, '1', '2024-02-14 17:04:03', '1', '2024-02-14 09:04:35', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_finance_receipt (id, no, status, receipt_time, finance_user_id, customer_id, account_id, total_price, discount_price, receipt_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (2, 'FKD20240214000001', 10, '2024-02-26 00:00:00', 112, 1, 1, 300.000000, 10.000000, 290.000000, '哈哈哈哈', '1', '2024-02-14 15:05:19', '1', '2024-02-14 09:00:22', true, 1), (3, 'FKD20240214000002', 10, '2024-02-20 00:00:00', NULL, 1, 1, -10.000000, 4.000000, -14.000000, NULL, '1', '2024-02-14 15:34:11', '1', '2024-02-14 09:00:18', true, 1), (4, 'FKD20240214000003', 10, '2024-02-18 00:00:00', NULL, 1, 1, 114.700000, 0.000000, 114.700000, NULL, '1', '2024-02-14 16:43:59', '1', '2024-02-14 08:58:43', true, 1), (5, 'FKD20240214000004', 10, '2024-02-19 00:00:00', NULL, 1, 1, 114.700000, 0.000000, 114.700000, NULL, '1', '2024-02-14 16:44:31', '1', '2024-02-14 08:55:13', true, 1), (6, 'FKD20240214000005', 10, '2024-02-19 00:00:00', NULL, 1, 1, -20.000000, 0.000000, -20.000000, NULL, '1', '2024-02-14 16:59:30', '1', '2024-02-14 09:00:16', true, 1), (7, 'FKD20240214000006', 10, '2024-02-20 00:00:00', NULL, 1, 1, -20.000000, 0.000000, -20.000000, NULL, '1', '2024-02-14 17:00:11', '1', '2024-02-14 09:00:41', true, 1), (8, 'FKD20240214000007', 10, '2024-02-20 00:00:00', 115, 1, 1, -20.000000, 0.000000, -20.000000, NULL, '1', '2024-02-14 17:01:27', '1', '2024-02-14 09:05:28', true, 1), (9, 'FKD20240214000008', 10, '2024-02-27 00:00:00', NULL, 1, 1, -143.200000, 0.000000, -143.200000, NULL, '1', '2024-02-14 17:04:03', '1', '2024-02-14 09:04:35', true, 1), (11, 'SKD20240216000001', 10, '2024-02-16 00:00:00', NULL, 2, 1, 50.000000, 10.000000, 40.000000, NULL, '1', '2024-02-16 07:59:54', '1', '2024-02-16 00:04:53', true, 1), (12, 'SKD20240216000002', 10, '2024-02-08 00:00:00', NULL, 2, 1, 50.000000, 0.000000, 50.000000, NULL, '1', '2024-02-16 08:02:24', '1', '2024-02-16 00:04:55', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_finance_receipt_item (id, receipt_id, biz_type, biz_id, biz_no, total_price, receipted_price, receipt_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (11, 2, 11, 16, 'CGRK20240213000001', 414.700000, 0.000000, 300.000000, '测试一下', '1', '2024-02-14 15:05:19', '1', '2024-02-14 09:00:22', true, 1), (12, 3, 12, 24, 'CGTH20240213000001', -163.200000, 0.000000, -10.000000, NULL, '1', '2024-02-14 15:34:11', '1', '2024-02-14 09:00:18', true, 1), (13, 4, 11, 16, 'CGRK20240213000001', 414.700000, 300.000000, 114.700000, NULL, '1', '2024-02-14 16:43:59', '1', '2024-02-14 08:58:43', true, 1), (14, 5, 11, 16, 'CGRK20240213000001', 414.700000, 300.000000, 114.700000, NULL, '1', '2024-02-14 16:44:31', '1', '2024-02-14 08:55:13', true, 1), (15, 6, 12, 24, 'CGTH20240213000001', -163.200000, -10.000000, -20.000000, NULL, '1', '2024-02-14 16:59:30', '1', '2024-02-14 09:00:16', true, 1), (16, 7, 12, 24, 'CGTH20240213000001', -163.200000, -10.000000, -20.000000, NULL, '1', '2024-02-14 17:00:11', '1', '2024-02-14 09:00:41', true, 1), (17, 8, 12, 24, 'CGTH20240213000001', -163.200000, 0.000000, -20.000000, NULL, '1', '2024-02-14 17:01:27', '1', '2024-02-14 09:05:29', true, 1), (18, 9, 12, 24, 'CGTH20240213000001', -163.200000, -20.000000, -143.200000, NULL, '1', '2024-02-14 17:04:03', '1', '2024-02-14 09:04:35', true, 1), (20, 11, 21, 14, 'XSCK20240215000001', 67.590000, 0.000000, 50.000000, NULL, '1', '2024-02-16 07:59:54', '1', '2024-02-16 00:04:53', true, 1), (21, 12, 21, 14, 'XSCK20240215000001', 67.590000, 0.000000, 50.000000, NULL, '1', '2024-02-16 08:02:24', '1', '2024-02-16 00:04:55', true, 1);
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
INSERT INTO erp_stock_check (id, no, check_time, total_count, total_price, status, remark, file_url, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (10, 'QCDB20240207000002', '2024-02-06 00:00:00', 23.000000, 76.590000, 10, NULL, NULL, '1', '2024-02-07 19:34:47', '1', '2024-02-08 00:49:53', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_stock_check_item (id, check_id, warehouse_id, product_id, product_unit_id, product_price, stock_count, actual_count, count, total_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (10, 10, 2, 1, 2, 3.330000, 0.000000, 0.000000, 23.000000, 76.590000, NULL, '1', '2024-02-07 19:34:47', '1', '2024-02-08 00:49:53', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_stock_in (id, no, supplier_id, in_time, total_count, total_price, status, remark, file_url, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (1, 'AAA', NULL, '2024-02-06 00:00:00', 5.010000, 14.683300, 10, NULL, NULL, '1', '2024-02-06 14:43:04', '1', '2024-02-16 09:26:55', true, 1), (2, '单据2', 1, '2024-02-22 00:00:00', 2.000000, 6.660000, 10, '测试一下', 'http://test.yudao.iocoder.cn/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.xls', '1', '2024-02-06 15:54:58', '1', '2024-02-16 09:26:53', true, 1), (3, '001', 1, '2024-02-06 00:00:00', 1.000000, 3.330000, 10, '给一个', NULL, '1', '2024-02-06 19:55:05', '1', '2024-02-16 09:26:50', true, 1), (4, '10', 1, '2024-02-06 00:00:00', 1.000000, 2.000000, 10, NULL, NULL, '1', '2024-02-06 20:18:48', '1', '2024-02-16 09:26:48', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_stock_in_item (id, in_id, warehouse_id, product_id, product_unit_id, product_price, count, total_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (1, 1, 1, 1, 2, 2.330000, 2.000000, 4.660000, NULL, '1', '2024-02-06 14:43:04', '1', '2024-02-16 09:26:55', true, 1), (2, 1, 2, 1, 2, 3.330000, 3.010000, 10.023300, NULL, '1', '2024-02-06 15:15:07', '1', '2024-02-16 09:26:55', true, 1), (3, 2, 2, 2, 2, 3.330000, 2.000000, 6.660000, NULL, '1', '2024-02-06 15:54:58', '1', '2024-02-16 09:26:53', true, 1), (4, 3, 2, 1, 2, 3.330000, 1.000000, 3.330000, NULL, '1', '2024-02-06 19:55:05', '1', '2024-02-16 09:26:50', true, 1), (5, 4, 2, 2, 2, 2.000000, 1.000000, 2.000000, NULL, '1', '2024-02-06 20:18:48', '1', '2024-02-16 09:26:48', true, 1);
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
INSERT INTO erp_stock_out (id, no, customer_id, out_time, total_count, total_price, status, remark, file_url, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (9, 'QCKD20240207000001', NULL, '2024-02-14 00:00:00', 1.000000, 2.000000, 10, '333', NULL, '1', '2024-02-07 14:59:53', '1', '2024-02-07 07:00:13', true, 1);
COMMIT;
BEGIN;
INSERT INTO erp_stock_out_item (id, out_id, warehouse_id, product_id, product_unit_id, product_price, count, total_price, remark, creator, create_time, updater, update_time, deleted, tenant_id) VALUES (10, 9, 2, 2, 2, 2.000000, 1.000000, 2.000000, NULL, '1', '2024-02-07 14:59:53', '1', '2024-02-07 07:00:13', true, 1);
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;
BEGIN;
COMMIT;

-- Re-enable triggers
SET session_replication_role = DEFAULT;

-- Update sequences to max id + 1
DO $$
DECLARE
    seq_name TEXT;
    table_name TEXT;
    max_id BIGINT;
BEGIN
    FOR seq_name, table_name IN
        SELECT s.relname, regexp_replace(s.relname, '_seq$', '')
        FROM pg_class s
        JOIN pg_namespace n ON s.relnamespace = n.oid
        WHERE s.relkind = 'S'
        AND n.nspname = 'public'
        AND s.relname ~ '^(erp_finance_payment|erp_finance_payment_item|erp_finance_receipt|erp_finance_receipt_item|erp_stock_check|erp_stock_check_item|erp_stock_in|erp_stock_in_item|erp_stock_out|erp_stock_out_item)_seq$'
    LOOP
        BEGIN
            EXECUTE format('SELECT COALESCE(MAX(id), 0) + 1 FROM %I', table_name) INTO max_id;
            IF max_id IS NOT NULL THEN
                EXECUTE format('ALTER SEQUENCE %I RESTART WITH %s', seq_name, max_id);
                RAISE NOTICE 'Updated sequence % to %', seq_name, max_id;
            END IF;
        EXCEPTION WHEN OTHERS THEN
            -- Table might not exist, skip
            NULL;
        END;
    END LOOP;
END $$;

-- Statistics
/*
Conversion Statistics:
  total_lines: 1073
  insert_statements: 10
  converted: 10
  skipped: 0
  errors: 0

Tables converted:
  - erp_finance_payment
  - erp_finance_payment_item
  - erp_finance_receipt
  - erp_finance_receipt_item
  - erp_stock_check
  - erp_stock_check_item
  - erp_stock_in
  - erp_stock_in_item
  - erp_stock_out
  - erp_stock_out_item
*/
